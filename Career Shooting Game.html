<!DOCTYPE html>
<html>
  <head>
    <link href="style.css" rel="stylesheet" type="text/css" media="all">
    <meta charset="UTF-8">
    <title>Carrer Shooting Game</title>
    <h3>å‡ºä¸–ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ  ~ãƒã‚¤ãƒ³ãƒˆã‚’æºœã‚ã¦å‡ºä¸–ã—ã‚ˆã†ï¼~</h3>
    <p>ã‚¹ã‚³ã‚¢ç›®å®‰â†“â†“  ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã­ã€‚</p>
    <p>Score 1~10 â‡¨ã€€å¹³ç¤¾å“¡ğŸ‘¨â€ğŸ’»</p>
    <p>Score 11~30 â‡¨ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ğŸ‘¨â€ğŸ’¼</p>
    <p>Score 31~50 â‡¨ ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ğŸ§‘</p>
    <p>Score 51~70 â‡¨ éƒ¨é•·ğŸ‘¨</p>
    <p>Score 71~90 â‡¨ å½¹å“¡ğŸ‘¨â€ğŸ¦³</p>
    <p>Score 91~ â‡¨ ç¤¾é•·ã”æ˜‡æ ¼ï¼ğŸ‰</p>
        
    <body>
      <canvas id="field" width="600" height="600"></canvas>
      <img id="back" src="back.png" style="display: none">
      <img id="enemy" src="enemy.png" style="display: none">
      <img id="ship" src="ship.png" style="display: none">

    </body>

    <script>
      "use strict";
      
      class Ship {
        // è‡ªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¤ã„ã¦ã®è¨­å®š
        constructor() {
          this.img = document.getElementById("ship");
          this.x = 300;
          this.y = 500;
          this.sx = 0;
          this.sy = 0;
        }
        move(mouseX, mouseY) {
          this.sx = (mouseX - this.x) / 10; // ãƒã‚¦ã‚¹ã‚’xæ–¹å‘ã¸ç§»å‹•
          this.sy = (mouseY - this.y) / 10; // ãƒã‚¦ã‚¹ã‚’yæ–¹å‘ã¸ç§»å‹•
        }
        tick() {
          this.x += this.sx; 
          this.y += this.sy; 
          ctx.drawImage(this.img, this.x - 50, this.y - 50);
        }
        shoot() {
          bullets.push(new Bullet(this.x, this.y, 0, -25, true)); // ãƒã‚¦ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã§å¼¾ã‚’ç™ºå°„
        }
      }

      class Enemy {
        // æ•µã®è¨­å®š
        constructor() {
          this.img = document.getElementById("enemy");
          this.x = Math.random() * 400 + 100; 
          this.y = 0; 
          this.sx = Math.random() * 5 - 2.5; 
          this.sy = Math.random() * 15 + 15; 
          this.shoot = false;
        }
        tick() {
          this.sy -= 1; 
          this.x += this.sx; 
          this.y += this.sy; 
          ctx.drawImage(this.img, this.x - 50, this.y - 50);

          if (this.shoot == false && this.sy < 0) {
            // ç”»é¢ã®ä¸Šã‹ã‚‰å‡ºã¦ãã¦ã‹ã‚‰æˆ»ã‚‹æ™‚ã«å¼¾ã‚’ç™ºå°„
            let theta = Math.atan2(ship.y - this.y, ship.x - this.x);
            let sx = Math.cos(theta) * 10;
            let sy = Math.sin(theta) * 10;
            bullets.push(new Bullet(this.x, this.y, sx, sy, false));
            this.shoot = true;
          }
        }
      }

      class Bullet {
        // å¼¾ã«ã¤ã„ã¦ã®è¨­å®šã€‚ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€èƒŒæ™¯ã®ä¸­ã«ãƒ©ãƒ³ãƒ€ãƒ ã«æ˜Ÿã‚’é…ç½®ã™ã‚‹ã€‚
        constructor(x, y, sx, sy, isShip) {
          this.x = x;
          this.y = y;
          this.sx = sx;
          this.sy = sy;
          this.isShip = isShip; 
        }
        tick() {
          this.x += this.sx;
          this.y += this.sy;
          drawCircle(this.x, this.y, 5, this.isShip ? "blue" : "red");
        }
      }

      class Star {
        // èƒŒæ™¯ã®æ˜Ÿã‚’å‹•ã‹ã™
        constructor() {
          this.x = Math.random() * 600; 
          this.y = Math.random() * 600; 
          this.r = Math.random() * 5 + 1; 
        }
        tick() {
          this.y += this.r; // ä¸Šã‹ã‚‰ä¸‹ã«å‹•ã‹ã—ã¦ã„ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
          if (this.y > 600) {
            // ä¸€ç•ªä¸‹ã¾ã§ç§»å‹•ã—ãŸã‚‰ã€ã¾ãŸä¸Šã«æˆ»ã‚‹ï¼ˆãƒ«ãƒ¼ãƒ—ï¼‰è¨­å®š
            this.y -= 600;
          }
          drawCircle(this.x, this.y, this.r, "#888800");
        }
      }

      function drawCircle(x, y, r, color) {
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.closePath();
        ctx.fill();
      }

      let ctx; 
      let ship; 
      let back; 
      let count = 0;  
      let interval = 50; // æ•µã®å‡ºç¾é »åº¦ã‚’è¨­å®š
      let timerId;  
      let bullets = []; 
      let enemies = []; 
      const stars = []; 
      let score = 0; 

      onload = function () {
        ctx = document.getElementById("field").getContext("2d");
        ctx.font = "32px 'Times New Roman'";
        ship = new Ship();  // è‡ªæ©Ÿã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
        back = document.getElementById("back");
        window.onpointermove = (e) => {
          ship.move(e.clientX, e.clientY);  // ãƒã‚¦ã‚¹ã‚’å·¦å³ã«å‹•ã‹ã—ã¦è‡ªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç§»å‹•
        };
        window.onpointerdown = (e) => {
          ship.shoot(); // ãƒã‚¦ã‚¹ã‚’æŠ¼ã™ã¨å¼¾ã‚’ç™ºå°„
        };
        timerId = setInterval(tick, 50);  
        for (let i = 0; i < 50; i++) {
          stars.push(new Star()); 
        }
      };

      function tick() {
        count++;
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, 600, 600);
        ctx.drawImage(back, 0, 0);
        stars.forEach((s) => s.tick()); 
        ship.tick();
        if (count % interval == 0) {
          enemies.push(new Enemy());  
          interval = Math.max(5, interval - 5);
        }
        let gameOver = false;
        enemies.forEach((e) => {
          e.tick(); 
          if (dist(e, ship) < 100) {
            gameOver = true;  // æ•µã¨ã®è·é›¢ãŒ100æœªæº€ã«ãªã‚‹ã¨ã¶ã¤ã‹ã£ãŸã¨è¦‹åšã—ã¦ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
          }
        });
        bullets.forEach((b) => {
          b.tick(); 
          if (!b.isShip && dist(b, ship) < 30) {
            gameOver = true;  // å¼¾ä¸¸ã¨ã®è·é›¢ãŒ30æœªæº€ã«ãªã‚‹ã¨ã¶ã¤ã‹ã£ãŸã¨ã—ã¦ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
          }
        });
        let prevNum = enemies.length;
        enemies = enemies.filter((e) => {
          return !bullets.some((b) => {
            return b.isShip && dist(e, b) < 50; // å¼¾ã¨æ•µã®è¡çªåˆ¤å®šã€‚è‡ªåˆ†ã®ç™ºå°„ã—ãŸå¼¾ã¨æ•µã®è·é›¢ãŒä¸€å®šä»¥ä¸‹ã«ãªã£ãŸæ™‚ã«æ’ƒå¢œã—ãŸã¨ã¿ãªã™ã€‚
          });
        });
        score += prevNum - enemies.length;
        ctx.fillStyle = "green";
        ctx.fillText("SCORE:" + score, 100, 100);//æ’ƒå¢œã—ãŸæ•µã®æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ã„ã

        if (gameOver) {
          clearInterval(timerId);
          ctx.fillStyle = "red";
          ctx.fillText("GAME OVER ğŸ˜­", 200, 300);//ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        }
      }

      function dist(e0, e1) {
        return Math.sqrt(
          Math.abs(e0.x - e1.x) ** 2 + Math.abs(e0.y - e1.y) ** 2
        );
      }
    </script>
  </head>

</html>
